<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Cr√©ation SmartLink - Production</title>

  <!-- Google Analytics DIRECT -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-P11JTJ21NZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-P11JTJ21NZ');
  </script>

  <!-- Google Tag Manager DIRECT -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-572GXWPP');</script>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .status {
      padding: 15px;
      margin: 15px 0;
      border-radius: 5px;
      font-weight: bold;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 5px;
    }
    .test-result {
      margin: 20px 0;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-572GXWPP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <div class="container">
    <h1>üß™ Test Cr√©ation SmartLink - Production</h1>
    <p>Cette page teste la cr√©ation de SmartLinks avec tracking direct (sans placeholders)</p>

    <div id="csp-status" class="status info">
      ‚è≥ V√©rification CSP en cours...
    </div>

    <div id="tracking-status" class="status info">
      ‚è≥ V√©rification des pixels en cours...
    </div>

    <button onclick="testSmartLinkCreation()">üîÑ Tester Cr√©ation SmartLink</button>
    <button onclick="testTagAssistant()">üéØ Tester Tag Assistant</button>

    <div class="test-result" id="test-results">
      <h3>üìä R√©sultats des tests :</h3>
      <div id="results-content">Cliquez sur les boutons pour commencer les tests...</div>
    </div>

    <div class="status info">
      <strong>Instructions :</strong><br>
      1. Cette page charge directement GA + GTM sans placeholders<br>
      2. Utilise Tag Assistant pour v√©rifier la d√©tection<br>
      3. Si √ßa marche ici, le probl√®me est la CSP de production<br>
      4. Si √ßa ne marche pas, probl√®me plus profond
    </div>
  </div>

  <script>
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const content = document.getElementById('results-content');
      content.innerHTML += `<div style="margin: 5px 0; color: ${type === 'error' ? 'red' : type === 'success' ? 'green' : 'blue'}">[${timestamp}] ${message}</div>`;
    }

    function checkCSP() {
      // Test si les scripts Google se chargent
      setTimeout(() => {
        if (typeof gtag !== 'undefined') {
          document.getElementById('csp-status').innerHTML = '‚úÖ CSP: Scripts Google autoris√©s';
          document.getElementById('csp-status').className = 'status success';
          log('‚úÖ CSP permet le chargement des scripts Google', 'success');
        } else {
          document.getElementById('csp-status').innerHTML = '‚ùå CSP: Scripts Google bloqu√©s';
          document.getElementById('csp-status').className = 'status error';
          log('‚ùå CSP bloque les scripts Google', 'error');
        }
      }, 2000);
    }

    function checkTracking() {
      setTimeout(() => {
        let trackingOK = 0;
        let trackingTotal = 2;

        if (typeof gtag !== 'undefined' && window.dataLayer) {
          log('‚úÖ Google Analytics d√©tect√©', 'success');
          trackingOK++;
        } else {
          log('‚ùå Google Analytics non d√©tect√©', 'error');
        }

        if (window.dataLayer && window.dataLayer.length > 0) {
          log('‚úÖ Google Tag Manager d√©tect√©', 'success');
          trackingOK++;
        } else {
          log('‚ùå Google Tag Manager non d√©tect√©', 'error');
        }

        if (trackingOK === trackingTotal) {
          document.getElementById('tracking-status').innerHTML = '‚úÖ Tracking: Tous les pixels d√©tect√©s';
          document.getElementById('tracking-status').className = 'status success';
        } else {
          document.getElementById('tracking-status').innerHTML = `‚ùå Tracking: ${trackingOK}/${trackingTotal} pixels d√©tect√©s`;
          document.getElementById('tracking-status').className = 'status error';
        }
      }, 3000);
    }

    function testSmartLinkCreation() {
      log('üîÑ Test de cr√©ation SmartLink...', 'info');

      const testData = {
        title: 'Test Production',
        artist: 'Test Artist',
        platforms: [],
        trackingPixels: {
          google_analytics: 'G-098G18MJ7M',
          google_tag_manager: 'GTM-572GXWPP',
          meta_pixel: null,
          tiktok_pixel: null,
          custom_scripts: []
        }
      };

      log('üì§ Donn√©es de test pr√©par√©es', 'info');
      log('üéØ IDs de tracking: GA=G-098G18MJ7M, GTM=GTM-572GXWPP', 'info');
      log('‚ö†Ô∏è Pour tester r√©ellement, utilise l\'interface de cr√©ation normale', 'info');
    }

    function testTagAssistant() {
      log('üéØ Test Tag Assistant...', 'info');

      if (typeof gtag !== 'undefined') {
        gtag('event', 'test_production', {
          event_category: 'test',
          event_label: 'production_test'
        });
        log('üìä √âv√©nement GA envoy√©', 'success');
      }

      log('üëÄ V√©rifie Tag Assistant maintenant', 'info');
      log('üéØ Devrait d√©tecter: G-P11JTJ21NZ + GTM-572GXWPP', 'info');
    }

    // Auto-check on load
    window.addEventListener('load', () => {
      log('üöÄ Page charg√©e, tests automatiques...');
      checkCSP();
      checkTracking();
    });
  </script>
</body>
</html>